!function(){var e,t,n,s={},a={Brightness:[0,200,100],Contrast:[0,200,100],Grayscale:[0,100,0],HueRotate:[0,360,0],Invert:[0,100,0],Saturate:[0,200,100],Sepia:[0,100,0]},i={},r={};const l=document.getElementById("sliderControl"),o=document.getElementById("addEffectBtn"),c=document.getElementById("loader"),d=document.getElementById("filterIndicator");var u;o.addEventListener("click",(()=>{Object.keys(i).length>0?(M.classList.remove("disabled"),o.classList.toggle("open")):(M.classList.add("disabled"),o.classList.toggle("open"))}));const m=document.getElementById("main"),g=document.getElementById("imgcanv");window.addEventListener("load",(function(){for(var e in g.width=window.innerWidth,g.height=window.innerHeight-150,localStorage)"USRPRE"==e.substring(0,6)&&ne(e.substring(6),localStorage[e],!1)}),!1),window.addEventListener("resize",(function(){clearTimeout(u),u=setTimeout((function(){m.classList.contains("hasimg")?(g.width=window.innerWidth,g.height=window.innerHeight-150,A()):(g.width=window.innerWidth,g.height=window.innerHeight-150)}),250)}));const v=document.getElementById("uploadBtn");var f,L,h;function E(){const e=g.getContext("2d"),t=h.naturalWidth,n=h.naturalHeight,s=g.width,a=g.height;if(e.imageSmoothingEnabled=!0,e.filter="none",D(),t>n){var i=t/s*100;if(i<=100)m.classList.add("hasimg"),y(),e.clearRect(0,0,s,a),e.drawImage(h,s/2-(t-40)/2,a/2-(n-40)/2,t-40,n-40);else{var r=n/(i/100);m.classList.add("hasimg"),y(),e.clearRect(0,0,s,a),e.drawImage(h,s/2-(s-40)/2,a/2-(r-40)/2,s-40,r-40)}}else if(n>=t){var l=n/a*100;if(l<=100)m.classList.add("hasimg"),y(),e.clearRect(0,0,s,a),e.drawImage(h,s/2-(t-40)/2,a/2-(n-40)/2,t-40,n-40);else{var o=t/(l/100);m.classList.add("hasimg"),y(),e.clearRect(0,0,s,a),e.drawImage(h,s/2-(o-40)/2,a/2-(a-40)/2,o-40,a-40)}}c.classList.remove("show"),T.classList.remove("hidden")}v.addEventListener("change",(function(){!function(){if("function"!=typeof window.FileReader)return alert("FILTERR is not supported by your browser!"),!1;v?v.files?v.files[0]?(W(),c.classList.add("show"),f=v.files[0],(L=new FileReader).onload=e,L.readAsDataURL(f)):alert("Please select a file first!"):alert('Browser does not support "files" property of file inputs.'):alert("No file!");function e(){(h=new Image).onload=E,h.src=L.result}}()}),!1),v.addEventListener("click",(function(){o.classList.remove("open")}),!1);const w=document.getElementById("controlsInit");function y(){w.classList.remove("init")}document.querySelectorAll(".filterChoice").forEach((t=>{t.addEventListener("click",(function(){o.classList.remove("open"),w.classList.remove("empty"),function(t){const n=t.innerHTML,i=(document.querySelectorAll(".filterIcon"),document.createElement("li")),r=(i.classList.add("filterIcon"),i.classList.add("filterIcon--"+n),i.setAttribute("data-filter",n),"a"+Date.now());i.setAttribute("id",r);e=i.getAttribute("id"),s[e]=new Array,s[e].push(n),s[e].push(a[n][2]),p.appendChild(i);let l=document.getElementById(e);S(n,null,l),i.addEventListener("click",(function(e){S(n,e)}),!1)}(t)}),!1)}));const p=document.getElementById("filterList");p.addEventListener("wheel",(e=>{e.preventDefault(),p.scrollLeft+=e.deltaY+e.deltaX}),!1);const I=document.getElementById("sliderToggle"),B=document.getElementById("removeBtn"),b=document.getElementById("doneBtn");function S(t,n,i){if(o.classList.remove("open"),null===n){e=i.getAttribute("id")}else{const t=n.target;e=t.getAttribute("id")}const r=s[e][0],c=s[e][1];l.setAttribute("min",a[t][0]),l.setAttribute("max",a[t][1]),l.value=c,k(c),R(r,!0),I.classList.add("slider")}function R(e,t){t?d.classList.add("show"):d.classList.remove("show"),d.innerHTML=e}function C(t){k(t.target.value);const n=t.target.value;s[e][1]=n,A()}l.addEventListener("change",(e=>C(e)),!1),l.addEventListener("input",(e=>C(e)),!1);const H=document.getElementById("sliderIndicator");function k(t){let n=Number(100*(l.value-l.min)/(l.max-l.min)),a=10-.2*n;if(H.style.left="calc("+n+"% + ("+a+"px))","HueRotate"==s[e][0]){const e="deg";H.innerHTML=t+e}else{const e="%";H.innerHTML=t+e}}function A(){if(Object.keys(s).length>0)for(var e in s){var t=s[e][0],n=s[e][1];"HueRotate"===t?(i[e]="Hue-Rotate("+n+"deg)",P()):(i[e]=t+"("+n+"%)",P())}else i={},P()}function P(){const e=Object.values(i).join(" ");!function(e){const t=g.getContext("2d"),n=h.naturalWidth,s=h.naturalHeight,a=g.width,i=g.height;t.imageSmoothingEnabled=!0,t.filter=e||"none";if(n>s){var r=n/a*100;if(r<=100)t.clearRect(0,0,a,i),t.drawImage(h,a/2-(n-40)/2,i/2-(s-40)/2,n-40,s-40);else{var l=s/(r/100);t.clearRect(0,0,a,i),t.drawImage(h,a/2-(a-40)/2,i/2-(l-40)/2,a-40,l-40)}}else if(s>=n){var o=s/i*100;if(o<=100)t.clearRect(0,0,a,i),t.drawImage(h,a/2-(n-40)/2,i/2-(s-40)/2,n-40,s-40);else{var c=n/(o/100);t.clearRect(0,0,a,i),t.drawImage(h,a/2-(c-40)/2,i/2-(i-40)/2,c-40,i-40)}}}(e),t=e}function W(){document.getElementById("controlsInit").classList.add("empty"),document.getElementById("filterList").innerHTML="",document.getElementById("sliderToggle").classList.remove("slider"),d.classList.remove("show")}function D(){for(var e in s)delete s[e];for(var e in i)delete i[e];t="",n=""}B.addEventListener("click",(function(){const t=document.querySelectorAll(".filterIcon"),n=document.getElementById(e);R("",!1),delete s[e],delete i[e],t.length>1?(I.classList.remove("slider"),n.remove(),P()):(I.classList.remove("slider"),n.remove(),w.classList.add("empty"),P())})),b.addEventListener("click",(function(){R("",!1),I.classList.remove("slider")}));const T=document.getElementById("saveBtn");function q(e,t,n){const s=document.createElement("canvas"),a=s.getContext("2d");if(1==n)if(e.naturalWidth>e.naturalHeight){let n=500/(e.naturalWidth/e.naturalHeight);s.width=500,s.height=n,a.imageSmoothingEnabled=!0,a.filter=t,a.drawImage(e,0,0,500,n)}else if(e.naturalWidth<e.naturalHeight){let n=500/(e.naturalHeight/e.naturalWidth);s.height=500,s.width=n,a.imageSmoothingEnabled=!0,a.filter=t,a.drawImage(e,0,0,n,500)}else a.height=500,s.width=500,a.imageSmoothingEnabled=!0,a.filter=t,a.drawImage(e,0,0,500,500);else{if(0!=n)return!1;s.width=e.naturalWidth,s.height=e.naturalHeight,a.imageSmoothingEnabled=!1,a.filter=t,a.drawImage(e,0,0,e.naturalWidth,e.naturalHeight)}return a.canvas}T.addEventListener("click",(function(e){if(T.classList.contains("hidden"))e.preventDefault();else{e.preventDefault(),o.classList.remove("open"),c.classList.add("show");var n=q(h,t,!1);let s=document.createElement("a");s.setAttribute("download","filterr.png"),n.toBlob((function(e){let t=URL.createObjectURL(e);s.setAttribute("href",t),s.click(),c.classList.remove("show")}))}}),!1);const M=document.getElementById("resetAllBtn"),N=document.getElementById("resetModal");M.addEventListener("click",(function(){if(!(document.querySelectorAll(".filterIcon").length>0))return!1;o.classList.remove("open"),N.classList.add("open")}),!1);const O=document.getElementById("modalCancelBtn"),j=document.getElementById("modalYesBtn");O.addEventListener("click",(function(){N.classList.remove("open")}),!1),j.addEventListener("click",(function(){W(),D(),A(),N.classList.remove("open")}),!1);var x={stainedOldPhoto:"Sepia(70%) Contrast(110%) Brightness(120%)",filmNegative:"Contrast(140%) Brightness(130%) Invert(100%) Grayscale(80%)",filmNegative2:"Contrast(40%) Invert(100%) Grayscale(80%) Sepia(100%)",BitofLife:"Contrast(130%) Hue-Rotate(10deg) Saturate(120%)",BlackNWhiteWash:"Grayscale(100%) Brightness(145%) Contrast(80%)",HighContrastBNW:"Grayscale(100%) Brightness(110%) Contrast(150%)",FlatWarm:"Contrast(80%) Hue-Rotate(350deg) Saturate(150%)",DoomandGloom:"Contrast(120%) Grayscale(45%) Brightness(90%) Hue-Rotate(20deg)",StiffBreeze:"Brightness(120%) Grayscale(30%) Hue-Rotate(10deg) Contrast(80%)",RawFeel:"Saturate(150%) Contrast(70%) Brightness(80%) Hue-Rotate(350deg)",SolarGlare:"Brightness(130%) Grayscale(25%) Hue-Rotate(355deg) Contrast(90%) Saturate(120%)",SoftPosterize:"Brightness(100%) Contrast(200%) Contrast(200%) Contrast(200%) Contrast(200%) Contrast(200%) Hue-Rotate(300deg) Sepia(60%)"};const G=document.getElementById("presetsBtn"),U=document.getElementById("presetsMenu"),F=document.getElementById("presetsList"),z=document.querySelectorAll("li#preset"),Y=document.getElementById("userPresetNewBtn"),X=document.getElementById("userPresetPlaceholder"),J=document.getElementById("menuContentWrapper"),K=document.getElementById("presetPreviewImg");function Q(e){var t=q(h,n=e,!0).toDataURL();K.style.backgroundImage!="url("+t+")"&&(K.style.backgroundImage="url("+t+")")}function V(e){if(e.classList.contains("active")||e.classList.contains("placeholder"))return!1;const s=e.getAttribute("data-presetID");var a;e.classList.add("active"),(a=e,Array.prototype.filter.call(a.parentNode.children,(function(e){return e!==a}))).forEach((e=>{e.classList.remove("active")})),e.classList.contains("userPreset")?Q(localStorage["USRPRE"+s]):Q(x[s]),n==t?ae.classList.remove("show"):ae.classList.add("show")}G.addEventListener("click",(function(){Q(t),ae.classList.remove("show");const e=document.querySelector(".active");null!=e&&e.classList.remove("active"),Object.keys(i).length>0?Y.style.display="grid":Y.style.display="none",o.classList.remove("open"),w.classList.add("init"),z.forEach((e=>{e.classList.contains("active")&&e.classList.remove("active")})),U.classList.add("open")}),!1),z.forEach((e=>{e.addEventListener("click",(function(){V(e)}),!1)}));const Z=document.getElementById("newPresetName"),$=document.getElementById("userPresetSaveBtn");function _(){""!=Z.value?$.classList.remove("disabled"):$.classList.add("disabled")}Z.addEventListener("input",_,!1),Z.addEventListener("change",_,!1);const ee=document.getElementById("newPresetPrint"),te=document.getElementById("previewToggle");Y.addEventListener("click",(function(){const e=Object.values(i).join(" ");ae.classList.remove("show"),te.classList.remove("previewOff"),Q(t),ee.innerHTML=e,Z.value="",_(),J.classList.add("save")}),!1);function ne(e,t,n){const s=document.createElement("li");X.classList.contains("visible")&&X.classList.remove("visible"),s.setAttribute("id","preset"),s.classList.add("userPreset"),s.setAttribute("data-presetID",e),s.innerHTML="<span>"+e+'</span><button class="userPresetDelete" id="userPresetDelete"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg></button>',s.addEventListener("click",(function(){V(this)}),!1),s.querySelector(".userPresetDelete").addEventListener("click",(function(){se(this)}),!1),n&&s.classList.add("active"),F.appendChild(s)}document.getElementById("userPresetBackBtn").addEventListener("click",(function(){Q(t),ae.classList.remove("show");const e=document.querySelector(".active");null!=e&&e.classList.remove("active"),J.classList.remove("save")}),!1),$.addEventListener("click",(function(){const e=document.getElementById("newPresetName").value,n=Object.values(i).join(" ");if($.classList.contains("disabled"))return!1;{if(localStorage["USRPRE"+e])return alert("That name already exists. Choose a new unique name.."),!1;localStorage.setItem("USRPRE"+e,n),Q(t);const s=document.querySelector(".active");null!=s&&s.classList.remove("active"),document.getElementById("newPresetName").value="",ee.innerHTML="",ne(e,n,!0),J.classList.remove("save")}}),!1),te.addEventListener("click",(function(){te.classList.contains("previewOff")?(Q(t),te.classList.remove("previewOff")):(Q(),te.classList.add("previewOff"))}),!1);function se(e){const n=e.parentNode,s=document.querySelectorAll(".userPreset"),a=n.getAttribute("data-presetID");n.classList.contains("active")&&(Q(t),ae.classList.remove("show")),n.classList.add("active"),localStorage.removeItem("USRPRE"+a),s.length<3?(F.removeChild(n),X.classList.add("visible")):F.removeChild(n)}document.querySelectorAll(".userPresetDelete").forEach((e=>{e.addEventListener("click",(function(){se(e)}),!1)}));document.getElementById("presetsCloseBtn").addEventListener("click",(function(){w.classList.remove("init"),U.classList.remove("open"),J.classList.remove("save"),ae.classList.remove("show")}),!1);const ae=document.getElementById("presetsApplyBtn");ae.addEventListener("click",(function(){t=n,W(),U.classList.remove("open"),ae.classList.remove("show"),w.classList.remove("init"),r=t.split(" "),D(),r.forEach((t=>{!function(t){let n=/\d+/g,a=t.match(n),i=/[^\d+()%\-]/g,r=t.match(i).join("");"HueRotatedeg"==r&&(r="HueRotate");const l=r,o=document.createElement("li"),c=(o.classList.add("filterIcon"),o.classList.add("filterIcon--"+l),o.setAttribute("data-filter",l),"a"+Date.now()+Math.random());o.setAttribute("id",c);e=o.getAttribute("id"),s[e]=new Array,s[e].push(l),s[e].push(a),p.appendChild(o);document.getElementById(e);o.addEventListener("click",(function(e){S(l,e)}),!1)}(t)})),w.classList.remove("empty"),A()}),!1)}();